<?php

class Module_Display_Catalogue_Object_PrivateTalk_List extends Dune_Include_Abstract_Code
{
    
    protected function code()
    {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
        Dune_Static_StylesList::add('catalogue/info/pablic_talk_list');
        $view = Dune_Zend_View::getInstance();
        if (Dune_Session::$auth)
        {
            Dune_Static_StylesList::add('catalogue/info/pablic_talk_list');
            
            $session = Dune_Session::getInstance(Dune_Session::ZONE_AUTH);        
            $user = $session->getZone();
            
            $talk = new Special_Vtor_PrivateTalk_List($user['user_id']);
            $talk->setTopicId($this->object->id);
            $talk->setInterlocutorId($this->object->saler_id);
            
            // Помечаем поле темукака прочитанную.
            $pTalk = new Special_Vtor_PrivateTalk_One($user['user_id']);
            $pTalk->setTopicId($this->object->id);
            $pTalk->setInterlocutorId($this->object->saler_id);
            $pTalk->read();
            
            
            $view->count = $talk->count();
            $view->seller = $this->object->saler_id;
            $view->list = $talk->getListCumulate();
        }
        else 
        {
            $view->count = 0;
            $view->list = array();

        }
        echo $view->render('bit/catalogue/object/talk_private/list_simple');
        

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
    }
}
    
    
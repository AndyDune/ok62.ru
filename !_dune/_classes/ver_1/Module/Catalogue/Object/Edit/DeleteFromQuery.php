<?php

class Module_Catalogue_Object_Edit_DeleteFromQuery extends Dune_Include_Abstract_Code
{
    
    protected function code()
    {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
        $this->setResult('success', false);
        $this->id = (int)$this->id;
        if ($this->id < 1)
            return false;
        
        $current_object = new Special_Vtor_Object_Query_Data($this->id);
        if (!$current_object->isFromBd())
            return false;
        if ($current_object->getUserId() != Special_Vtor_User_Auth::$id)
            return false;
            
        $photo = new Special_Vtor_Object_Query_Image($current_object->getId(), $current_object->getTime());    
        $plan = new Special_Vtor_Object_Query_Plan($current_object->getId(), $current_object->getTime());    
        $photo->deletePreviewFolder();
        $plan->deletePreviewFolder();
        $photo->deleteFolder();
        $plan->deleteFolder();

        $current_object->delete();

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        
    }
    
}
    
    